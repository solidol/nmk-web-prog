# Лекція 9. Альтернативні засоби під'єднання до СУБД MySQL

[Перелік лекцій](../README.md)

## Вступ до PDO: Що це і для чого потрібно  
PDO (PHP Data Objects) — це розширення для роботи з базами даних у PHP, яке надає уніфікований інтерфейс для взаємодії з різними СУБД (системами управління базами даних). Основна перевага використання PDO полягає в тому, що воно дозволяє писати код, який працюватиме з різними базами даних без необхідності змінювати сам код. Це особливо корисно, якщо ви плануєте міграцію з однієї СУБД на іншу або хочете підтримувати декілька СУБД одночасно.

PDO підтримує безліч популярних баз даних, таких як MySQL, PostgreSQL, SQLite та інші. Це робить його універсальним інструментом для розробників, які працюють з різними базами даних. Уніфікований інтерфейс PDO дозволяє розробникам зосередитися на логіці застосунку, а не на особливостях конкретної бази даних. Це значно спрощує процес розробки та зменшує кількість помилок, пов'язаних із несумісністю різних СУБД.

Крім того, PDO підтримує підготовлені вирази, що робить його безпечнішим у порівнянні з традиційними методами роботи з базами даних. Підготовлені вирази допомагають уникнути SQL-ін'єкцій, які є однією з найпоширеніших вразливостей у веб-застосунках. Це особливо важливо для застосунків, які обробляють користувацькі дані, адже зловмисники можуть використовувати SQL-ін'єкції для несанкціонованого доступу до бази даних.

## Встановлення та налаштування PDO
Для початку роботи з PDO необхідно переконатися, що розширення PDO встановлено і ввімкнено у вашій установці PHP. Зазвичай PDO увімкнено за замовчуванням, але якщо це не так, вам потрібно внести зміни у файл конфігурації php.ini.

## Перевірка наявності PDO
Щоб перевірити, чи встановлено розширення PDO, можна скористатися функцією `phpinfo()`. Створіть файл `info.php` з таким вмістом:

```php
<?php
phpinfo();
?>
```

Відкрийте цей файл у браузері і знайдіть секцію, присвячену PDO. Якщо ви бачите інформацію про PDO, це означає, що розширення встановлено і готове до використання. У виведенні `phpinfo()` ви знайдете інформацію про підтримувані драйвери PDO, такі як `pdo_mysql`, `pdo_pgsql`, `pdo_sqlite` та інші. Це дасть вам упевненість, що ваше середовище готове до роботи з різними базами даних через PDO.

## Встановлення PDO (якщо не встановлено)
Якщо PDO не встановлено, вам потрібно буде встановити його вручну. Для цього виконайте наступні команди в залежності від вашої операційної системи:

**Для Linux (Ubuntu/Debian):**
```bash
sudo apt-get install php-pdo
sudo service apache2 restart
```

**Для Windows:**
- Відкрийте файл `php.ini`.
- Знайдіть рядок `;extension=pdo_mysql` і видаліть крапку з комою на початку рядка.
- Перезапустіть веб-сервер (наприклад, Apache або Nginx).

Після виконання цих кроків PDO буде встановлено і готове до використання. Якщо ви використовуєте інші операційні системи, такі як macOS, процес встановлення може трохи відрізнятися, але основні кроки залишаються тими ж: встановлення розширення та перезапуск веб-сервера.

## Підключення до бази даних з використанням PDO
Після встановлення і налаштування PDO можна підключатися до бази даних. Для цього використовується клас PDO, який приймає кілька параметрів: DSN (Data Source Name), ім'я користувача та пароль.

### Приклад підключення до бази даних MySQL
```php
<?php
$dsn = 'mysql:host=localhost;dbname=testdb';
$username = 'root';
$password = '';

try {
    $pdo = new PDO($dsn, $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    echo "Підключення успішне!";
} catch (PDOException $e) {
    echo "Помилка підключення: " . $e->getMessage();
}
?>
```

У цьому прикладі ми створюємо об'єкт PDO, передаючи йому DSN, ім'я користувача та пароль. Також ми встановлюємо режим обробки помилок за допомогою методу `setAttribute`. Це дозволяє легко відстежувати помилки та обробляти їх відповідним чином. У разі успішного підключення ви побачите повідомлення "Підключення успішне!", а у разі помилки — повідомлення з її описом.

### Приклад підключення до бази даних PostgreSQL
```php
<?php
$dsn = 'pgsql:host=localhost;dbname=testdb';
$username = 'root';
$password = '';

try {
    $pdo = new PDO($dsn, $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    echo "Підключення успішне!";
} catch (PDOException $e) {
    echo "Помилка підключення: " . $e->getMessage();
}
?>
```

Цей приклад аналогічний попередньому, але використовується для підключення до бази даних PostgreSQL. Як бачите, зміна СУБД вимагає мінімальних змін у коді, що є однією з основних переваг використання PDO.

## Виконання запитів: SELECT, INSERT, UPDATE, DELETE
Після успішного підключення до бази даних можна виконувати різні SQL-запити. Розглянемо основні операції: SELECT, INSERT, UPDATE і DELETE.

### SELECT
Для виконання запиту SELECT використовується метод `query` або комбінація методів `prepare` і `execute`.

```php
<?php
$sql = 'SELECT * FROM users';
foreach ($pdo->query($sql) as $row) {
    print_r($row);
}
?>
```

У цьому прикладі ми виконуємо простий SELECT-запит і виводимо результати за допомогою циклу `foreach`. Метод `query` повертає об'єкт `PDOStatement`, який можна використовувати для ітерації по результатах запиту.

### INSERT
Для вставки даних використовується метод `prepare` і `execute`.

```php
<?php
$sql = 'INSERT INTO users (name, email) VALUES (:name, :email)';
$stmt = $pdo->prepare($sql);
$stmt->execute(['name' => 'John Doe', 'email' => 'john@example.com']);
echo "Запис додано!";
?>
```

У цьому прикладі ми використовуємо підготовлені вирази для вставки даних у таблицю `users`. Метод `prepare` готує SQL-запит, а метод `execute` виконує його з вказаними параметрами.

### UPDATE
Для оновлення даних також використовується метод `prepare` і `execute`.

```php
<?php
$sql = 'UPDATE users SET email = :email WHERE name = :name';
$stmt = $pdo->prepare($sql);
$stmt->execute(['email' => 'john_new@example.com', 'name' => 'John Doe']);
echo "Запис оновлено!";
?>
```

Цей приклад показує, як оновити дані в таблиці `users` з використанням підготовлених виразів. Ми оновлюємо поле `email` для користувача з ім'ям John Doe.

### DELETE
Для видалення даних використовується метод `prepare` і `execute`.

```php
<?php
$sql = 'DELETE FROM users WHERE name = :name';
$stmt = $pdo->prepare($sql);
$stmt->execute(['name' => 'John Doe']);
echo "Запис видалено!";
?>
```

У цьому прикладі ми видаляємо запис з таблиці `users`, де ім'я користувача дорівнює John Doe. Використання підготовлених виразів робить цей процес безпечним і ефективним.

## Обробка помилок і безпека при роботі з PDO
Робота з базами даних завжди пов'язана з ризиками, такими як SQL-ін'єкції та помилки виконання запитів. PDO надає кілька механізмів для обробки помилок
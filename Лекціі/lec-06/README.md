# Лекція 6. Обмін великими об'ємами даних з сервером

[Перелік лекцій](../README.md)

## Завантаження файлів методом POST

Через цей механізм можна завантажувати як текстові, так і бінарні файли. Використовуючи PHP-функції для аутентифікації та роботи з файлами, програміст має повний контроль над тим, кому дозволено завантажувати файли на сервер, і що робити з ними після завантаження.

PHP підтримує прийом завантажених файлів із браузерів, які сумісні зі стандартом RFC-1867.

### Примітка: Суміжні налаштування конфігурації
Ознайомтеся також з описом директив конфігураційного файлу `php.ini`: `file_uploads`, `upload_max_filesize`, `upload_tmp_dir`, `post_max_size` і `max_input_time`.

PHP також підтримує завантаження файлів методом PUT, який використовується, зокрема, клієнтами Netscape Composer та Amaya (консорціум W3C). Детальніше про цей метод можна дізнатися у розділі "Підтримка методу PUT".

## Приклад #1 Форма для завантаження файлів

Сторінка для завантаження файлів на сервер реалізується через форму, яка виглядає приблизно так:

```html
<!-- Тип кодування даних, enctype, необхідно вказувати, як показано у прикладі -->
<form enctype="multipart/form-data" action="__URL__" method="POST">
    <!-- Поле MAX_FILE_SIZE повинно бути вказано перед полем завантаження файлу -->
    <input type="hidden" name="MAX_FILE_SIZE" value="30000" />
    <!-- Назва елемента input визначає назву елемента в суперглобальному масиві $_FILES -->
    Завантажити файл: <input name="userfile" type="file" />
    <input type="submit" value="Завантажити файл" />
</form>
```

У наведеному прикладі значення `__URL__` необхідно замінити на посилання до PHP-файлу.

Приховане поле `MAX_FILE_SIZE` (значення вказується в байтах) має бути перед полем вибору файлу. Воно задає максимальний розмір файлу, який приймає PHP. Це зручно, оскільки користувач дізнається про обмеження до завершення завантаження. Однак це обмеження легко обійти на стороні браузера, тому для надійного контролю розміру файлу використовуйте налаштування PHP.

**Примітка**: Переконайтеся, що форма завантаження містить атрибут `enctype="multipart/form-data"`, інакше завантаження файлів не працюватиме.

## Суперглобальний масив $_FILES

Масив `$_FILES` містить інформацію про завантажені файли:

- `$_FILES['userfile']['name']` — початкова назва файлу на комп'ютері клієнта.
- `$_FILES['userfile']['type']` — MIME-тип файлу, якщо браузер надав таку інформацію.
- `$_FILES['userfile']['size']` — розмір файлу у байтах.
- `$_FILES['userfile']['tmp_name']` — тимчасове ім'я файлу на сервері.
- `$_FILES['userfile']['error']` — код помилки, яка виникла під час завантаження.

Зберігання файлів виконується у тимчасовій папці, яку можна змінити через налаштування `upload_tmp_dir` у файлі `php.ini`.

## Приклад #2 Перевірка файлів, які завантажили на сервер

Для обробки файлів використовуються функції `is_uploaded_file()` і `move_uploaded_file()`. Наступний приклад демонструє прийом та обробку завантаженого файлу:

```php
<?php

$uploaddir = '/var/www/uploads/';
$uploadfile = $uploaddir . basename($_FILES['userfile']['name']);

echo '<pre>';
if (move_uploaded_file($_FILES['userfile']['tmp_name'], $uploadfile)) {
    echo "Файл успішно завантажено.\n";
} else {
    echo "Можлива атака через завантаження файлу!\n";
}

echo 'Додаткова інформація:';
print_r($_FILES);

echo '</pre>';

?>
```

## Приклад #3 Завантаження масиву файлів

PHP підтримує передачу масиву файлів через HTML-форму:

```html
<form action="" method="post" enctype="multipart/form-data">
    <p>Зображення:
        <input type="file" name="pictures[]" />
        <input type="file" name="pictures[]" />
        <input type="file" name="pictures[]" />
        <input type="submit" value="Відправити" />
    </p>
</form>
```

Обробка масиву файлів у PHP:

```php
<?php

foreach ($_FILES["pictures"]["error"] as $key => $error) {
    if ($error == UPLOAD_ERR_OK) {
        $tmp_name = $_FILES["pictures"]["tmp_name"][$key];
        $name = basename($_FILES["pictures"]["name"][$key]);
        move_uploaded_file($tmp_name, "data/$name");
    }
}

?>
```

Інформацію про реалізацію відстеження прогресу завантаження файлів можна знайти у розділі про сесії та відстеження завантаження.

# Лекція 14. Засоби шаблонізації у РНР

[Перелік лекцій](../README.md)

Шаблонізація є невід’ємною частиною сучасних програмних систем, особливо тих, що створюють динамічний інтерфейс або відповідають на запити користувачів у вигляді HTML, XML, PDF, email-повідомлень, SMS-повідомлень чи будь-яких інших текстових структур. Поняття шаблонізації загалом означає процес формування підсумкового документа, сторінки або фрагмента інтерфейсу на основі певного шаблону — наперед визначеної структури, у якій деякі частини можуть змінюватися залежно від даних.

У центрі підходу шаблонізації лежить ідея розділення даних і представлення. Кінцевий вигляд сторінки залежить від шаблону, а зміст — від моделі або будь-якого іншого джерела даних. Завдяки цьому дизайнер може працювати над зовнішнім виглядом сторінки, не втручаючись у програмну логіку, тоді як програміст може змінювати поведінку системи, не зачіпаючи структуру шаблону. Це створює чистіший, зрозуміліший код і дає змогу легко змінювати зовнішній вигляд без ризику пошкодити функціональність застосунку.

Практика показує, що шаблон є свого роду “формою”, у яку під час виконання вставляються значення. Наприклад, сторінка профілю користувача може мати HTML-код із позначками там, де мають з’явитися ім’я, аватар, список публікацій чи інша інформація. Шаблони дозволяють додавати не лише дані, але й елементарну логіку представлення: умовні конструкції, цикли, фрагменти, що повторюються, а також вставку інших шаблонів. Проте важливо, щоб ця логіка стосувалася лише зовнішнього вигляду, а не бізнес-правил, адже шаблонізація не призначена для того, щоб замінювати повноцінні програмні обчислення.

У більшості систем шаблонізатор працює як двоетапна модель. Спочатку шаблон розбирається на токени: статичні частини (наприклад, текст і HTML) та динамічні елементи (вставки змінних, умовні блоки). На другому етапі, коли програма передає дані, шаблонізатор замінює динамічні частини фактичними значеннями та формує готовий документ. Цей процес може бути одноразовим (наприклад, при генерації email-повідомлення), або повторюваним для кожного запиту, як у вебзастосунках. Складніші шаблонізатори часто кешують попередньо розібрані шаблони у вигляді внутрішнього дерева або навіть транскомпілюють шаблони в код високорівневої мови, завдяки чому виробляють кінцевий HTML значно швидше.

Ще однією важливою характеристикою шаблонізації є підтримка компонентів та фрагментів. У великих проєктах небажано створювати один монолітний шаблон для кожної сторінки. Натомість застосовують дрібні, повторно використовувані частини: шапку, навігаційне меню, футер, картку товару, форму коментаря. Ці мінішаблони можуть підключатися до основного або бути об’єднані у складніші компоненти. Завдяки цьому відбувається модульність: змінюючи один компонент, ми автоматично оновлюємо всі сторінки, що його використовують. Такий підхід значно зменшує дублювання коду та мінімізує ризики помилок.

У деяких архітектурах шаблонізація має ще глибшу роль — вона стає інструментом побудови інтерфейсу. У фронтенд-фреймворках шаблони можуть оновлюватися реактивно: коли змінюються дані, змінюється і вигляд без повного перерендерингу сторінки. У серверних системах шаблонізація натомість забезпечує швидке формування статичних відповідей, зменшуючи навантаження на сервер та спрощуючи підтримку. Попри ці відмінності, принципи залишаються однаковими: шаблон відповідає за структуру та вигляд, а логіка — за обробку інформації.

Потрібно також враховувати аспект безпеки, адже шаблони нерідко працюють із даними, введеними користувачем. Шаблонізатори зазвичай мають вбудовані механізми екранування, щоб запобігти виконанню шкідливого коду або вставці небезпечних HTML-фрагментів. Розробник повинен розуміти, як ці механізми працюють, щоб уникнути таких поширених загроз, як XSS-атаки.

У підсумку шаблонізація є універсальним і надзвичайно корисним інструментом, який дає змогу відділити логіку від представлення, створювати модульні інтерфейси, полегшувати роботу як програмістів, так і дизайнерів, а також забезпечувати масштабованість і чистоту коду. Вона є спільною рисою майже всіх сучасних вебфреймворків і застосунків, незалежно від мови програмування чи платформи. Розробник, який добре розуміє принципи шаблонізації, отримує потужний набір інструментів для створення гнучких і надійних інтерфейсів, що можуть розвиватися та адаптуватися до змін без необхідності переписувати всю систему з нуля.

## Різновиди шаблонізаторів

У світі програмування існує кілька різних підходів до шаблонізації, кожен із яких по-своєму балансує між гнучкістю, швидкістю і зручністю використання. Найбільш традиційними є логічні або “класичні” шаблонізатори, у яких шаблон складається переважно зі статичного HTML чи тексту, а динамічні частини позначені спеціальними директивами. У таких системах розробнику дозволяється певна мінімальна логіка — наприклад, умовні оператори чи цикли. Цей тип шаблонізаторів застосовується у широкому спектрі фреймворків: від PHP-темплейтів до Jinja2 у Python або Twig у PHP.

Другим типом є декларативні шаблонізатори, які роблять акцент на структурі, а не на імперативних операціях. Вони обмежують програмну логіку, дозволяючи в шаблоні лише декларативні правила відображення. Це дозволяє зменшити складність і виключити помилки, спричинені надмірним винесенням логіки в шаблон. Такі рішення часто використовуються в статичних генераторах сайтів або фреймворках, які суворо дотримуються принципу “view must be dumb” — тобто view повинне бути максимально простим.

Окремої уваги заслуговують реактивні шаблонізатори, які лягли в основу сучасних фронтенд-фреймворків. Тут шаблон не просто текст із підставленими значеннями — це функціональна структура, яка автоматично оновлюється при зміні стану. Фреймворки на кшталт Vue, Angular або Svelte працюють саме з таким підходом: HTML-структура є декларативною мовою, яка описує, що потрібно відобразити, а реактивний механізм забезпечує оновлення інтерфейсу без ручного втручання. Цей тип шаблонізації найбільш близький до концепції компонентів та динамічних інтерфейсів.

## Компіляція шаблонів

У багатьох сучасних системах шаблони не просто розбираються під час виконання, а проходять процес компіляції. Це означає, що шаблонізатор перетворює текст шаблону у внутрішнє дерево, а потім — у високоефективний код. Наприклад, шаблон може бути перетворений у функцію, яка приймає дані та повертає сформований HTML. Такий підхід використовується для значного прискорення рендерингу.

Компіляція також дозволяє шаблонізатору виконувати додаткові оптимізації: мінімізувати операції у циклах, об’єднувати статичні частини, кешувати результати аналізу, виявляти помилки ще до запуску додатка. У фронтенд-фреймворках компіляція шаблонів часто є частиною збірки: шаблони перетворюються у високоефективні JavaScript-функції, що мінімізує обсяг роботи в браузері.

## Компоненти та часткові шаблони

У великих проєктах шаблонізація майже неможлива без розбиття інтерфейсу на дрібні, повторно використовувані частини. Такі частини називаються частковими шаблонами (partials) або компонентами, залежно від рівня складності. Частковий шаблон — це, по суті, фрагмент сторінки: наприклад, картка товару, блок коментарів або шапка сайту. Його можна включати в інші шаблони декількома рядками, забезпечуючи модульність та зменшуючи дублювання.

Компоненти є вищим рівнем шаблонізації. Вони поєднують у собі структуру, бізнес-логіку інтерфейсу та навіть внутрішній стан. Компонент можна сприймати як маленький самостійний елемент інтерфейсу, який має власні дані та правила оновлення. Такий підхід широко застосовується у фронтенді, але і серверні фреймворки часто запозичують цю ідею. Завдяки компонентам інтерфейс стає передбачуваним, а зміни можна вносити локально, не ризикуючи порушити інші частини системи.

## Безпечна шаблонізація та екранування даних

Питання безпеки є критично важливим для будь-якої системи, яка працює з користувацькими даними. Найбільш поширеною загрозою у шаблонізації є XSS-атаки, коли шкідливий код потрапляє у шаблон і вбудовується в HTML. Щоб цього уникнути, шаблонізатор повинен автоматично екранувати (escape) дані: перетворювати небезпечні символи на безпечні HTML-послідовності. Це робить неможливим виконання введеного скрипту.

У хороших шаблонізаторах екранування виконується автоматично, але може бути вимкнене вручну у тих рідкісних випадках, коли потрібно вивести HTML, який є довіреним. Більше того, сучасні системи іноді використовують контекстно-залежне екранування: різні правила для тексту, атрибутів, URL-значень або JavaScript-контекстів. Це ще більше знижує ризик небезпечного коду.

Додаткові механізми передбачають перевірку типів, фільтрування дозволених тегів та обмеження доступу до внутрішніх структур шаблонізатора, щоб уникнути ін’єкцій шаблонів. Розробник повинен чітко розуміти, як саме працює екранування в обраному фреймворку, аби не створювати діри в безпеці.

## Підсумок

Шаблонізація є фундаментальною технологією, яка забезпечує відділення логіки від інтерфейсу, підтримку модульності, швидкість розробки та стабільність системи. Різновиди шаблонізаторів дозволяють підібрати підхід під конкретні потреби: від простих текстових шаблонів до реактивних, динамічних компонентів. Компіляція шаблонів забезпечує продуктивність, тоді як компоненти надають масштабованість і повторне використання. А питання безпеки роблять шаблонізацію не просто зручною, а життєво необхідною для правильного функціонування вебзастосунку.
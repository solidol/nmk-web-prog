[Перелік усіх робіт](README.md)

# Лабораторна робота №22. Створення моделей, контролерів та міграцій

## Мета роботи

Навчитися працювати з моделями, розділяти проєкт на структурні частини, використовувати файли конфігурації для збереження налаштувань проекту.

## Обладнання

Персональний комп'ютер. Пакет програм XAMPP. Текстовий редактор Sublime Text 3 або IDE NetBeans. Web-браузер Chrome, Firefox, Opera

## Теоретичні відомості

### Створення моделі
Використовуйте команду Artisan для створення моделі. Наприклад, для створення моделі з ім'ям Product, введіть:

```sh
php artisan make:model Product
```

Ця команда створить файл моделі в директорії `app/`.

Опціонально: Вказання таблиці бази даних:
Якщо ви хочете вказати назву таблиці бази даних для цієї моделі, ви можете додати параметр `--table`:

```sh
php artisan make:model Product --table=products
```

Це вказує Laravel використовувати таблицю з ім'ям "products" для цієї моделі.

### Створення контролера

Використовуйте команду Artisan для створення контролера. Наприклад, для контролера з ім'ям ProductController, введіть:

```sh
php artisan make:controller ProductController
```

Ця команда створить файл контролера в директорії `app/Http/Controllers/`.

Вказання ресурсного контролера (опціонально):
Якщо ви створюєте контролер для роботи з ресурсом (наприклад, CRUD операції), ви можете використовувати флаг `--resource`:

```sh
php artisan make:controller ProductController --resource
```

Це створить ресурсний контролер, який включає в себе стандартні методи для роботи з ресурсами (index, create, store, show, edit, update, destroy).

Вказання моделі для контролера (опціонально):
Ви можете вказати модель, якою користуватиметься контролер, додавши флаг --model:

```sh
php artisan make:controller ProductController --model=Product
```

Це дозволяє автоматично включити модель у контролер і визначити зв'язок між ними.

Після цих кроків ви зможете переглядати та редагувати створені файли моделі та контролера відповідно до вашого функціоналу та бізнес-логіки.


### Міграції та їх створення

У Laravel міграція - це інструмент для керування структурою бази даних. Вона надає зручний спосіб опису змін у базі даних та їх виконання. Laravel використовує мову програмування PHP для створення та виконання міграцій.

Основні концепції міграцій у Laravel включають:

1. Створення та Застосування Змін:
Ви можете використовувати міграції для опису створення та змін структури бази даних. Міграції включають методи для додавання таблиць, видалення таблиць, додавання чи видалення стовпців та багато іншого.

2. Контроль версій:
Laravel зберігає історію виконаних міграцій в базі даних. Це дозволяє вам та вашій команді з легкістю відстежувати та керувати змінами структури бази даних через час.

3. Просте Застосування та Відміна:
Ви можете легко застосовувати нові міграції або відміняти зміни, які вже були застосовані. Це забезпечує простий механізм для розвитку вашого додатка та ведення бази даних у відповідності до ваших потреб.

4. Робочий змінами в командному рядку:
Laravel має командні рядки Artisan для створення нових міграцій, застосування їх та відміни. Наприклад, ви можете викликати команду php artisan migrate для застосування всіх нових міграцій.

Створення однієї міграції виглядає наступним чином:

```sh
php artisan make:migration create_products_table
```



Типова міграція виглядає наступним чином:

```php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     *
     * @return void
     */
    public function up()
    {
        Schema::create('additionals', function (Blueprint $table) {
            $table->id();
            $table->timestamps();
            $table->morphs('additionable');
            $table->string('title')->default('Не вказано');
            $table->string('description',3000)->default('');
            $table->smallInteger('additional_type')->unsigned()->default(0)->comment('0 - file, 100 - URL, 101 - youtube');
            $table->string('link',3000)->default('')->comment('URL ресурса або шлах у ФС');
        });
    }

    /**
     * Reverse the migrations.
     *
     * @return void
     */
    public function down()
    {
        Schema::dropIfExists('additionals');
    }
};
```

Викорати міграції (розгорнути базу даних) можна наступним чином:

```sh
php artisan migrate
```

Процес успішної міграції виглядає наступним чином:

![](img/lab-22/22-030.png)

Також можна виконати відкат за допомогою команди:

```sh
php artisan migrate --rollback
```

### Пакетне створення моделі, міграції та контролера

Створити одночасно модель, її контролер та міграцію можливо командою

```sh
php artisan make:model Product -mc
```

![](img/lab-22/22-050.png)


Повний перелік ключів до команди `make:model` виглядає наступним чином:

![](img/lab-22/22-060.png)

### Обмеження MySQL

під час запуску стокової міграції на СКБД MySQL буде помилка:

![](img/lab-22/22-020.png)

Дана помилка виникає через спробу створити індекс для унікального текстового поля занадто великої довжини. Для виправлення цієї помилки необхідно очистити базу даних, оскільки відкат міграції не спрацює належним чином, та відредагувати файл `app\Providers\AppServiceProvider.php` наступним чином:

```php
    public function boot()
    {
        Schema::defaultStringLength(191);
        Paginator::useBootstrap();
    }
```

Збережіть відредагований файл та виконайте міграцію знову.

## Хід роботи
1. Впевнитись, що пакет XAMPP встановлено, web-сервер Apache запущений, віртуальний хост сворено та на ньому розгорнений фреймворк Laravel
2. Перейти до каталогу `C:\xampp\htdocs\laravel_test`, який було створено у ЛР 21. 
3. Впевніться, що установка пройшла успішно і фреймворк запускається
4. Відповідно до тематики вашої роботи створіть необхадні моделі, міграції та контролери.
5.  Заповніть порожні міграції потрібними даними, відповідно до теми вашого проєкту. 
6.  Відредагувати файл `app\Providers\AppServiceProvider.php` відповідно до прикладу у теоретичних відомостях.
7.  Виконайте міграцію.
8.  Впевніться, що необхадні таблиці створені, шляхом перегляду бази даних через phpMyAdmin.
9.  Вивантажте проект на Github.
10. Для кожного етапу роботи зробіть знімки екрану та додайте їх у звіт з описом кожного скіншота.
11. Дайте відповіді на контрольні запитання
12. Додайте в кінці звіту посилання на репозиторій з лабораторною роботою
13. Збережіть звіт у форматі PDF
14. Додайте звіт до репозиторія

## Приклади

1. [Папка порожнього проекту (без підкаталога vendor)](src/lab-21/)


## Контрольні питання

1. Як викликати команду Artisan для створення нової міграції в Laravel?
2. Які директиви визначаються у методі up міграції?
3. Як визначити нову таблицю та відповідні стовпці у Laravel міграції?
4. Як можна додати індекс до стовпця за допомогою міграції в Laravel?
5. Як використовувати міграції для зміни типу або імені стовпців в таблиці?
6. Як визначити зовнішній ключ у Laravel міграції?
7. Як можна створити команду Artisan для відміни (відкату) останньої міграції?
8. Як додати стовпець зі значенням за замовчуванням у Laravel міграції?
9. Чому корисно використовувати метод down у Laravel міграціях?
10. Як використовувати Artisan для застосування всіх міграцій у вашому додатку?


## Довідники та додаткові матеріали

1. [Laravel](https://laravel.com/)
2. [COMPOSER A Dependency Manager for PHP](https://getcomposer.org/)
3. [Packagist](https://packagist.org/)
4. [Laravel installation](https://laravel.com/docs/4.2)
5. [Migrations: Creating Columns](https://laravel.com/docs/10.x/migrations#creating-columns)


## Альтернатвні теми за варіантами

Варіяант для виконання самостійних завдань

1. Каталог товарів продуктового магазину
2. Каталог книг у бібліотеці
3. Дошка оголошень
4. Фотогалерея
5. Каталог запчастин автомобілів
6. Індивідуальний електронний записник
7. Каталог рієлтора
8. Каталог бази будівельних матеріалів
9. Власний блог
10. Розклад маршрутів автовокзалу